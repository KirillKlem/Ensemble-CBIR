# Проект "Поиск смысловых копий изображений" (Content-Based Image Retrieval - CBIR)

В данном проекте представлена система поиска изображений, организованная в формате Content-Based Image Retrieval (CBIR), которая позволяет находить визуально или смыслово схожие изображения. Цель системы — по входному изображению предоставить до 10 релевантных рекомендаций из обучающего множества, где релевантность определяется принадлежностью к одному смысловому классу. Эта система продемонстрировала высокую эффективность, точность и готовность к масштабированию, что делает её мощным инструментом для поиска и анализа визуальных данных.

### Основные компоненты проекта

#### app.py
**app.py** — основной файл, который запускает систему и объединяет все этапы обработки изображений и поиска. Этот файл отвечает за запуск всей системы и может быть легко интегрирован как в веб-сервис, так и в локальный интерфейс для взаимодействия. Здесь реализована основная логика для интеграции предобученных моделей, а также обработка и анализ входных изображений. В этом модуле также внедрена поддержка ансамбля моделей, что значительно повышает надежность и точность системы. Данный подход соответствует концепции CBIR и поддерживает производительность системы на высоком уровне.

#### cnn_image_classifier_with_retrieval.py
**cnn_image_classifier_with_retrieval.py** — скрипт, объединяющий задачи классификации изображений и поиска смысловых копий. Здесь используются сверточные нейронные сети, такие как ConvNeXt и ResNet50v2, которые обеспечивают надежную классификацию и извлечение признаков изображений для поиска похожих объектов. Благодаря комбинации этих моделей система достигает высокой точности поиска и масштабируемости. Также используется ансамблевый метод, где несколько моделей обучены на одной задаче и работают вместе для более надежных и точных рекомендаций. Этот подход учитывает современные требования к обоснованности метода и прозрачности системы.

#### crop.py
**crop.py** — модуль для предобработки изображений, отвечающий за обрезку лишних областей. С его помощью из изображений удаляются области, не содержащие смысловую информацию, что позволяет фокусироваться на главных признаках объектов. Этот процесс улучшает извлечение признаков и точность модели, что особенно важно для задач поиска на основе визуальных признаков. Данный этап предобработки повышает масштабируемость системы, позволяя обрабатывать большие объемы данных без потерь в качестве.

#### requirements.txt
**requirements.txt** — файл с перечислением всех необходимых библиотек и зависимостей для запуска системы. Это значительно упрощает развертывание проекта, позволяя устанавливать все зависимости автоматически и избегать потенциальных проблем совместимости.

### Директории

#### helpers
**Папка `helpers`** содержит важные вспомогательные модули и функции, поддерживающие основной код проекта. Здесь также хранятся некоторые предобученные модели и утилиты (utils) для обработки изображений и работы с эмбеддингами. Эти модули обеспечивают стабильную и эффективную работу системы, а также поддерживают высокую производительность в обработке данных. Включение предобученных моделей и дополнительных инструментов здесь упрощает интеграцию новых методов и алгоритмов в систему и делает её адаптивной к изменениям данных или задач.

#### source_code
**Папка `source_code`** включает "черновые" ноутбуки и код, использовавшийся на начальных этапах разработки. Здесь производились первичные обработки данных, предобучение моделей, настройка алгоритмов и тестирование идей. Это ценный архив исследовательских данных, который помогает отслеживать весь процесс разработки и внедрения методов CBIR. Включение таких ноутбуков позволяет понять и воспроизвести ход мысли разработчиков, а также дает возможность улучшать текущую систему на основе прошлых исследований.

## Задача проекта

Цель проекта — создать систему поиска изображений по смысловым копиям. Система принимает изображение на вход и возвращает до 10 релевантных изображений из обучающего набора, принадлежащих к тому же смысловому классу. Релевантность определяется принадлежностью изображений к одному классу, а качество системы оценивается с помощью метрики **MAP@10**. Проект ориентирован на практическое применение, что делает его подходящим для реальных задач, где важны точность и масштабируемость.

## Методология и реализация

Для выполнения задачи поиска изображений в формате CBIR использован многокомпонентный подход, включающий несколько передовых моделей и методов.

### Использование ансамбля моделей

Для улучшения точности и адаптивности системы применена стратегия ансамбля моделей, включающая **ConvNeXt**, **ResNet50v2**, **ViT-CLIP**, и подход **GLRT-Based Metric Learning**. Ансамбль позволяет получить взвешенные предсказания от нескольких мощных архитектур, что увеличивает надежность поиска и адаптивность к новым данным.

### GLRT-Based Metric Learning

В проекте также применяется **GLRT-Based Metric Learning** — метод обучения метрик, который помогает системе оптимально различать классы, учитывая их визуальные и смысловые различия. Этот метод основан на использовании метрики правдоподобия Generalized Likelihood Ratio Test (GLRT), которая повышает точность поиска. GLRT позволяет уменьшить межклассовое сходство и минимизировать внутриклассовое различие, что особенно важно для задачи поиска смысловых копий. Такой подход повышает прозрачность решения, так как создаваемые модели предсказуемо выделяют ключевые признаки для каждой категории изображений.

### Предварительно рассчитанные эмбеддинги

Для оптимизации и масштабируемости система использует предварительно рассчитанные эмбеддинги изображений. Это позволяет избежать дорогостоящих вычислений на этапе поиска и значительно повышает производительность. Предварительное вычисление эмбеддингов позволяет системе легко масштабироваться и обрабатывать большие объемы данных, поддерживая высокую точность поиска.

### Индексы FAISS и Annoy

Для быстрого поиска ближайших соседей (ANN) в большом пространстве признаков используются **FAISS** и **Annoy**. **FAISS** обеспечивает высокую производительность и точность, особенно при поиске по сложным эмбеддингам, и оптимизирован для работы на GPU, что ускоряет обработку на больших наборах данных. **Annoy** также применяется для эффективного поиска похожих эмбеддингов, поддерживая высокую скорость поиска в памяти, что особенно полезно при обработке огромных объемов данных. Комбинация FAISS и Annoy делает систему гибкой и высокоэффективной для масштабируемых задач и позволяет ей работать с большими наборами изображений без потерь в скорости и точности.

### Ключевые преимущества

1. **Обоснованность выбранного метода**:
   - Использование проверенных и мощных моделей, таких как ConvNeXt, ResNet50v2, ViT-CLIP и GLRT-Based Metric Learning, гарантирует высокое качество и надежность системы. Благодаря ансамблю моделей система адаптируется к различным типам данных и предоставляет точные и релевантные результаты.

2. **Прозрачность решения**:
   - Код проекта структурирован, что делает его легко воспроизводимым и доступным для понимания. Логическое разделение на компоненты и использование вспомогательных модулей позволяет глубже понять каждый этап обработки и поиска. Модули для предобработки, аугментации и классификации, а также методы извлечения и обработки признаков обеспечивают полный контроль над качеством рекомендаций.

3. **Адаптивность и масштабируемость решения**:
   - Использование ANN-индексов и Annoy позволяет системе быстро и точно обрабатывать большие объемы данных. Проект готов к работе с большими наборами изображений благодаря предварительно рассчитанным эмбеддингам, что повышает скорость обработки и гибкость системы. При этом высокая точность сохраняется даже на крупных датасетах, что подтверждает её масштабируемость.

4. **Релевантность поставленной задаче**:
   - Проект отвечает всем требованиям задачи CBIR и построен с учётом необходимости находить смысловые копии изображений. Весь стек технологий и архитектурные решения ориентированы на оптимизацию поиска и улучшение релевантности, что делает проект незаменимым инструментом для поиска по смыслу в больших изображениях.

5. **Реализация дополнительных идей**:
   - Использование техник аугментации, замораживания слоев модели и снижения размерности с помощью PCA добавляет системе устойчивость и улучшает точность поиска. Эти техники помогают улучшить качество рекомендаций, особенно в условиях работы с разнообразными данными.

## Заключение

Проект успешно реализует основные принципы Content-Based Image Retrieval (CBIR) с акцентом на точность, расширяемость и высокую производительность. Включение таких мощных инструментов, как ConvNeXt, ViT-CLIP и GLRT-Based Metric Learning, обеспечивает высочайшее качество поиска смысловых копий и делает проект эффективным инструментом для анализа и поиска по изображению.
